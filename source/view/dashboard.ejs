<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    
	<script type='text/javascript' src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.0.min.js'></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.0/js.cookie.min.js"></script>
    <script type="text/javascript" src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato">
</head>

<body>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	
	<ul>
        <li><a class="active" href="/">Welcome to Attack on Tutor, (<%= user.name %>) </a></li>

		<!-- , (<%= user.id %>) -->
		
		<li style="float:right"><a class="active" href="https://github.com/nus-mtp/etutorial">GitHub Repository</a></li>
		
        <% if(user){ %>
            <li style="float:right"><a class="active" id="logout" >Log Out</a></li>
		<% } else{ %>
            <li style="float:right"><a class="active" href="/login" >Log In</a></li>
        <% } %>
    </ul>

	<input id="uid" type="hidden" value="<%= user.id %>">


	<div class="container">
		<div class="row">
			<div class="col-md-12" style="background-color:#141311">
				<h2>Modules</h2>
				<div class="moduleList">
					<ul id="tutorials" style="color:cyan"></ul>
					
					<!--<img src="https://www.w3schools.com/css/trolltunga.jpg" alt="Troll Tunga" height="200" width="550">
					<img src="https://www.w3schools.com/css/trolltunga.jpg" alt="Troll Tunga" height="200" width="550">-->
					
					<form id='form' style='display: hidden' action='' method='POST'>
						<ul id="tutorials"></ul>
					</form>
				</div>
			</div>
		</div>
	</div>
	
</div>
</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

<script type="application/javascript">

    var tutorials = [];

    function syncIVLE() {
        $.ajax({
            method:'POST',
            url:'/api/dashboard/forceSyncIVLE',
            dataType:'json',
            success: function(data){
                if (data.success){
                    console.log("Successful Sync");
                    getTutorials();
                }
                else {  
                    console.log('Failed Sync, Error: ' + data.message);
                }

            }
        });
    }
    
    function getTutorials() {
        $.ajax({
            type: 'POST',
            url: '/api/dashboard/getTutorials',
            data: { },
            dataType: 'json',
            success: function(data) {
                showTutorials(data.data);
            }
        });
    }

    function showTutorials(tuts) {
        for (i = 0; i < tuts.count; i++) {
            var tut = tuts.rows[i];

            console.log(tut);
            tutorials.push(tut);
			
            $('#tutorials').append(tut.coursecode + " " + tut.coursename + " <button class='btn btn-primary' id='lobby-button' data-id='" + i + "' value='' name='tut-id'> Join Class </button><br><br>");
		}
    }


    $(document).on('click', '#lobby-button', function () {
        var index = $(this).attr('data-id');
        var tut = tutorials[index];
        $(this).attr('value', tut.id);
        $('#form').attr('action', 'lobby/'+tut.coursecode+'/'+tut.name);
    });
	
	syncIVLE();

</script>

<style>
	body {
		background-color: #E9E9E9;
	}

	ul {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #141311;
    }
	
    li {
        float: left;
    }
	
    li a {
		font-family: 'Lato', serif;
		font-size: 1.5vw;
        color: #FFFFFF;
        display: block;
        padding: 10px;
        text-align: center;
		text-decoration: none;
    }
	
    li a:hover {
        background-color: #B7B7B6;
    }
	
	h2 {
		font-family: 'Lato', serif;
		font-weight: bold;
		font-size: 24px;
		text-align: center;
		color: #A2482E;
	}

	#logout {
        cursor: pointer;
    }
	
	.avatarWardrobe {
		text-align: center;
	}
	
	.moduleList {
		text-align: center;
	}
	
	.col-md-12 {
		margin-top: 3.5%;
		height: 80vh;
	}
</style>